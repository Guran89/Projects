--Lista med publikationsID för publikationer där både Chalmers och GU förekommer.

SELECT c.pubid
FROM uplmain AS c
INNER JOIN person_publ AS pp ON c.dbid = pp.dbid
INNER JOIN dept_pers_publ AS dpp ON pp.pd_id = dpp.pd_id
INNER JOIN departments AS d ON dpp.deptid = d.deptid
INNER JOIN dept_instance AS di ON d.deptid = di.deptid
WHERE di.instanceid = 1
AND c.pubyear > 2012
AND c.pubyear <= 2014
INTERSECT
SELECT c.pubid
FROM uplmain AS c
INNER JOIN person_publ AS pp ON c.dbid = pp.dbid
INNER JOIN dept_pers_publ AS dpp ON pp.pd_id = dpp.pd_id
INNER JOIN departments AS d ON dpp.deptid = d.deptid
INNER JOIN dept_instance AS di ON d.deptid = di.deptid
WHERE di.instanceid = 2
AND c.pubyear > 2012
AND c.pubyear <= 2014


--Lista med publikationsID och InstanceID för publikationer där både Chalmers och GU förekommer.

SELECT c.pubid, array_to_string(array_agg(di.instanceid), '; ')
FROM uplmain AS c
INNER JOIN person_publ AS pp ON c.dbid = pp.dbid
INNER JOIN dept_pers_publ AS dpp ON pp.pd_id = dpp.pd_id
INNER JOIN departments AS d ON dpp.deptid = d.deptid
INNER JOIN dept_instance AS di ON d.deptid = di.deptid
WHERE pubid IN (SELECT c.pubid
FROM uplmain AS c
INNER JOIN person_publ AS pp ON c.dbid = pp.dbid
INNER JOIN dept_pers_publ AS dpp ON pp.pd_id = dpp.pd_id
INNER JOIN departments AS d ON dpp.deptid = d.deptid
INNER JOIN dept_instance AS di ON d.deptid = di.deptid
WHERE di.instanceid = 1
AND c.pubyear > 2012
AND c.pubyear <= 2014
INTERSECT
SELECT c.pubid
FROM uplmain AS c
INNER JOIN person_publ AS pp ON c.dbid = pp.dbid
INNER JOIN dept_pers_publ AS dpp ON pp.pd_id = dpp.pd_id
INNER JOIN departments AS d ON dpp.deptid = d.deptid
INNER JOIN dept_instance AS di ON d.deptid = di.deptid
WHERE di.instanceid = 2
AND c.pubyear > 2012
AND c.pubyear <= 2014)
GROUP BY pubid