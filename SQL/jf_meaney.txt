—-Paul Meaney har ”Meaney” som personid, vilket gör att algoritmen inte fungerar. Tillfälligt uppdaterad algoritm som löser problemet för stunden.

SELECT
  CASE
    WHEN t.personid = 0
      THEN namn
    ELSE p.lastname||', '||p.firstname
  END AS helnamn, t.personid, COUNT(DISTINCT t.isi_id) AS top10
FROM(
   SELECT kaw.namn, CAST(kaw.personid AS INTEGER), cwts.isi_id, cwts.percx5
   FROM cwts, kaw
   WHERE cwts.isi_id = kaw.isi_id
   AND NOT kaw.personid = 'Meaney'
   AND cwts.percx5 > 80
   AND cwts.py BETWEEN 2003 AND 2012) AS t
INNER JOIN persons AS p ON t.personid = p.personid
GROUP BY t.personid, helnamn