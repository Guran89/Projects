--WoS_2.1
--Kod för att beräkna antal publikationer i WoS för K respektive B, bakåt i tiden med hjälp av personlista.
SELECT temp.py, COUNT(DISTINCT temp.isi_id)
FROM (
	SELECT isi.py, din.inst_sv AS inst, isi.isi_id, pkb.k, pkb.bio
	FROM isi_full AS isi
	INNER JOIN cross_isi_cpl AS cic ON isi.isi_id = cic.isi_id
	INNER JOIN uplmain AS c ON cic.cpl_pubid = c.pubid
	INNER JOIN person_publ AS pp ON c.dbid = pp.dbid
	INNER JOIN persons AS p ON pp.personid = p.personid
	INNER JOIN dept_pers_publ AS dpp ON pp.pd_id = dpp.pd_id
	INNER JOIN dept_instance AS di ON dpp.deptid = di.deptid
	INNER JOIN dept_inst AS din ON dpp.deptid = din.deptid --dept_inst är en vy som anger institution för varje post i tabellen departments
	INNER JOIN pers_k_bio AS pkb ON p.personid = pkb.personid
	WHERE di.instanceid = 1
	AND isi.py in (2011, 2012, 2013, 2014) --Ändra till aktuella år
	AND (isi.dt LIKE '%Article%' OR isi.dt LIKE 'Review%' OR isi.dt LIKE '%Letter%')
	AND pkb.k = 'Y'
	--AND pkb.bio = 'Y'
	AND din.inst_sv = 'Institutionen för kemi- och bioteknik'
	) AS temp
GROUP BY temp.py, temp.inst
ORDER BY temp.py
